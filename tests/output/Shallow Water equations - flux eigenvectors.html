<!doctype html>
<html>
	<head>
		<meta charset='utf-8'>
		<title>Shallow Water Equations - flux eigenvectors</title>
		<script type='text/javascript' src='./tryToFindMathJax.js'></script>
	</head>
	<body>

variables:
<br>
${ {(n_1)}} ^i$	= flux surface normal, in units of $[1]$
<br>
$h$	= wave height, in units of 	$m$
<br>
${ v} ^i$	= velocity, in units of 	${\frac{1}{s}} {m}$
<br>
${{ m} ^i} = {{{h}} {{{ v} ^i}}}$	= momentum, in units of 	$\frac{kg}{{{{m}^{2}}} {{s}}}$
<br>
$\gamma$	= pull of gravitation, in units of 	$\frac{m}{{s}^{2}}$
<br>
$H$	= seafloor depth, in units of 	$m$
<br>
${c} = {\sqrt{{{\gamma}} \cdot {{h}}}}$	= speed of sound in units of 	${\frac{1}{s}} {m}$
<br>
${{ g} _i} _j$	= metric tensor, in units of $[1]$
<br>
Conservative and primitive variables:
<br>
${{ W} ^I} = {\left[\begin{array}{c} h\\ { v} ^i\end{array}\right]}$
<br>
${{ U} ^I} = {\left[\begin{array}{c} h\\ { m} ^i\end{array}\right]}$
<br>
Partial of conservative quantities wrt primitives:
<br>
${\frac{\partial { U} ^I}{\partial { W} ^J}} = {\left[\begin{array}{cc} \frac{\partial h}{\partial h}& \frac{\partial h}{\partial { v} ^j}\\ \frac{\partial { m} ^i}{\partial h}& \frac{\partial { m} ^i}{\partial { v} ^j}\end{array}\right]}$
<br>
${\frac{\partial { U} ^I}{\partial { W} ^J}} = {\left[\begin{array}{cc} \frac{\partial h}{\partial h}& \frac{\partial h}{\partial { v} ^j}\\ {\frac{\partial}{\partial h}}\left({{{h}} {{{ v} ^i}}}\right)& {\frac{\partial}{\partial { v} ^j}}\left({{{h}} {{{ v} ^i}}}\right)\end{array}\right]}$
<br>
${\frac{\partial { U} ^I}{\partial { W} ^J}} = {\left[\begin{array}{cc} 1& 0\\ { v} ^i& {{h}} {{{{ δ} ^i} _j}}\end{array}\right]}$
<br>
${\frac{\partial { U} ^I}{\partial { W} ^J}} = {\left[\begin{array}{cccc} 1& 0& 0& 0\\ { v} ^x& h& 0& 0\\ { v} ^y& 0& h& 0\\ { v} ^z& 0& 0& h\end{array}\right]}$
<br>
${\frac{\partial { W} ^I}{\partial { U} ^J}} = {\left[\begin{array}{cccc} 1& 0& 0& 0\\ -{{\frac{1}{h}} {{ v} ^x}}& \frac{1}{h}& 0& 0\\ -{{\frac{1}{h}} {{ v} ^y}}& 0& \frac{1}{h}& 0\\ -{{\frac{1}{h}} {{ v} ^z}}& 0& 0& \frac{1}{h}\end{array}\right]}$
<br>
${\frac{\partial { W} ^I}{\partial { U} ^J}} = {\left[\begin{array}{cc} 1& 0\\ {\frac{1}{h}}{\left({-{{ v} ^i}}\right)}& {\frac{1}{h}} {{{ δ} ^i} _j}\end{array}\right]}$
<br>

<br>
Flux:
<br>
${{ F} ^I} = {\left[\begin{array}{c} {{h}} {{{ v} ^j}} {{{ {(n_1)}} _j}}\\ {{{h}} {{{ v} ^i}} {{{ v} ^j}} {{{ {(n_1)}} _j}}} + {{{\frac{1}{2}}} {{\gamma}} \cdot {{{h}^{2}}} {{{ {(n_1)}} ^i}}}\end{array}\right]}$
<br>
${{ F} ^I} = {\left[\begin{array}{c} {{h}} {{{ {(n_1)}} _j}} {{{ v} ^j}}\\ {{{\frac{1}{2}}} {{\gamma}} \cdot {{{ {(n_1)}} ^i}} {{{h}^{2}}}} + {{{h}} {{{ {(n_1)}} _j}} {{{ v} ^i}} {{{ v} ^j}}}\end{array}\right]}$
<br>

<br>
Flux derivative wrt primitive variables:
<br>
${\frac{\partial { F} ^I}{\partial { W} ^J}} = {\left[\begin{array}{cc} {\frac{\partial}{\partial h}}\left({{{h}} {{{ {(n_1)}} _k}} {{{ v} ^k}}}\right)& {\frac{\partial}{\partial { v} ^j}}\left({{{h}} {{{ {(n_1)}} _k}} {{{ v} ^k}}}\right)\\ {\frac{\partial}{\partial h}}\left({{{{\frac{1}{2}}} {{\gamma}} \cdot {{{ {(n_1)}} ^i}} {{{h}^{2}}}} + {{{h}} {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}}}}\right)& {\frac{\partial}{\partial { v} ^j}}\left({{{{\frac{1}{2}}} {{\gamma}} \cdot {{{ {(n_1)}} ^i}} {{{h}^{2}}}} + {{{h}} {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}}}}\right)\end{array}\right]}$
<br>
${\frac{\partial { F} ^I}{\partial { W} ^J}} = {\left[\begin{array}{cc} {{{ {(n_1)}} _k}} {{{ v} ^k}}& {{h}} {{{ {(n_1)}} _j}}\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^i}}} + {{{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}}}& {{{h}} {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{h}} {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{{ δ} ^i} _j}}}\end{array}\right]}$
<br>
${\frac{\partial { F} ^I}{\partial { W} ^J}} = {\left[\begin{array}{cc} {{{ {(n_1)}} _a}} {{{ v} ^a}}& {{h}} {{{ {(n_1)}} _j}}\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}}& {{{h}} {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{h}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}}\end{array}\right]}$
<br>

<br>
Flux derivative wrt conserved variables:
<br>
${\frac{\partial { F} ^I}{\partial { U} ^J}} = {{{\frac{\partial { F} ^I}{\partial { W} ^L}}} {{\frac{\partial { W} ^L}{\partial { U} ^J}}}}$
<br>
${\frac{\partial { F} ^I}{\partial { U} ^J}} = {{{\left[\begin{array}{cc} {{{ {(n_1)}} _a}} {{{ v} ^a}}& {{h}} {{{ {(n_1)}} _k}}\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}}& {{{h}} {{{ {(n_1)}} _k}} {{{ v} ^i}}} + {{{h}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _k}}}\end{array}\right]}} {{\left[\begin{array}{cc} 1& 0\\ {\frac{1}{h}}{\left({-{{ v} ^k}}\right)}& {\frac{1}{h}} {{{ δ} ^k} _j}\end{array}\right]}}}$
<br>
${\frac{\partial { F} ^I}{\partial { U} ^J}} = {\left[\begin{array}{cc} {{{{ {(n_1)}} _a}} {{{ v} ^a}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ v} ^k}}}& {{{ {(n_1)}} _k}} {{{{ δ} ^k} _j}}\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^i}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^k}} {{{{ δ} ^i} _k}}}& {{{{ {(n_1)}} _k}} {{{ v} ^i}} {{{{ δ} ^k} _j}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _k}} {{{{ δ} ^k} _j}}}\end{array}\right]}$
<br>
${\frac{\partial { F} ^I}{\partial { U} ^J}} = {\left[\begin{array}{cc} 0& { {(n_1)}} _j\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^i}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}}& {{{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}}\end{array}\right]}$
<br>

<br>
Flux derivative matrix times state
<br>
${{{\frac{\partial { F} ^I}{\partial { U} ^J}}} {{U}}} = {{{\left[\begin{array}{cc} 0& { {(n_1)}} _j\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^i}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}}& {{{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}}\end{array}\right]}} {{\left[\begin{array}{c} h\\ { m} ^j\end{array}\right]}}}$
<br>
${{{\frac{\partial { F} ^I}{\partial { U} ^J}}} {{U}}} = {{{\left[\begin{array}{cc} 0& { {(n_1)}} _j\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^i}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}}& {{{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}}\end{array}\right]}} {{\left[\begin{array}{c} h\\ {{h}} {{{ v} ^j}}\end{array}\right]}}}$
<br>
${{{\frac{\partial { F} ^I}{\partial { U} ^J}}} {{U}}} = {\left[\begin{array}{c} {{h}} {{{ {(n_1)}} _j}} {{{ v} ^j}}\\ {{h}} {{\left({{{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^i}}}{-{{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}}} + {{{{ {(n_1)}} _j}} {{{ v} ^i}} {{{ v} ^j}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^j}} {{{{ δ} ^i} _j}}}}\right)}}\end{array}\right]}$
<br>
${{{\frac{\partial { F} ^I}{\partial { U} ^J}}} {{U}}} = {\left[\begin{array}{c} {{h}} {{{ {(n_1)}} _j}} {{{ v} ^j}}\\ {{{\gamma}} \cdot {{{ {(n_1)}} ^i}} {{{h}^{2}}}} + {{{h}} {{{ {(n_1)}} _j}} {{{ v} ^i}} {{{ v} ^j}}}\end{array}\right]}$
<br>
${{ F} ^I} = {\left[\begin{array}{c} {{h}} {{{ {(n_1)}} _j}} {{{ v} ^j}}\\ {{{\frac{1}{2}}} {{\gamma}} \cdot {{{ {(n_1)}} ^i}} {{{h}^{2}}}} + {{{h}} {{{ {(n_1)}} _j}} {{{ v} ^i}} {{{ v} ^j}}}\end{array}\right]}$
<br>

<br>
As you can see, the shallow water equations' $\frac{\partial F}{\partial U} \cdot U \ne F$.  This statement happens to be true for the Euler fluid equations, and lots of literature of solvers based on the Euler fluid equations depend on this equality, which is simply not always true.
<br>

<br>
Flux derivative wrt conserved variables, expanded:
<br>
${\frac{\partial { F} ^I}{\partial { U} ^J}} = {\left[\begin{array}{cccc} 0& { {(n_1)}} _x& { {(n_1)}} _y& { {(n_1)}} _z\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^x}}}{-{{{{ v} ^x}} {{{ {(n_1)}} _k}} {{{ v} ^k}}}}& {{{{ {(n_1)}} _x}} {{{ v} ^x}}} + {{{{ {(n_1)}} _k}} {{{ v} ^k}}}& {{{ {(n_1)}} _y}} {{{ v} ^x}}& {{{ {(n_1)}} _z}} {{{ v} ^x}}\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^y}}}{-{{{{ v} ^y}} {{{ {(n_1)}} _k}} {{{ v} ^k}}}}& {{{ {(n_1)}} _x}} {{{ v} ^y}}& {{{{ {(n_1)}} _y}} {{{ v} ^y}}} + {{{{ {(n_1)}} _k}} {{{ v} ^k}}}& {{{ {(n_1)}} _z}} {{{ v} ^y}}\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^z}}}{-{{{{ v} ^z}} {{{ {(n_1)}} _k}} {{{ v} ^k}}}}& {{{ {(n_1)}} _x}} {{{ v} ^z}}& {{{ {(n_1)}} _y}} {{{ v} ^z}}& {{{{ {(n_1)}} _z}} {{{ v} ^z}}} + {{{{ {(n_1)}} _k}} {{{ v} ^k}}}\end{array}\right]}$
<br>

<br>
Acoustic matrix:
<br>
${{{{ A} ^I} _J} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^I} _J}}}} = {{{\frac{\partial { W} ^I}{\partial { U} ^K}}} {{\frac{\partial { F} ^K}{\partial { W} ^J}}}}$
<br>
${{{{ A} ^I} _J} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^I} _J}}}} = {{{\left[\begin{array}{cc} 1& 0\\ {\frac{1}{h}}{\left({-{{ v} ^i}}\right)}& {\frac{1}{h}} {{{ δ} ^i} _k}\end{array}\right]}} {{\left[\begin{array}{cc} {{{ {(n_1)}} _a}} {{{ v} ^a}}& {{h}} {{{ {(n_1)}} _j}}\\ {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^k}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^k}}}& {{{h}} {{{ {(n_1)}} _j}} {{{ v} ^k}}} + {{{h}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^k} _j}}}\end{array}\right]}}}$
<br>
${{{{ A} ^I} _J} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^I} _J}}}} = {\left[\begin{array}{cc} {{{ {(n_1)}} _a}} {{{ v} ^a}}& {{h}} {{{ {(n_1)}} _j}}\\ {\frac{1}{h}}{\left({{-{{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}}} + {{{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^k}} {{{{ δ} ^i} _k}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^k}} {{{{ δ} ^i} _k}}}}\right)}& {-{{{{ {(n_1)}} _j}} {{{ v} ^i}}}} + {{{{ {(n_1)}} _j}} {{{ v} ^k}} {{{{ δ} ^i} _k}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _k}} {{{{ δ} ^k} _j}}}\end{array}\right]}$
<br>
${{{{ A} ^I} _J} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^I} _J}}}} = {\left[\begin{array}{cc} {{{ {(n_1)}} _a}} {{{ v} ^a}}& {{h}} {{{ {(n_1)}} _j}}\\ {{\gamma}} \cdot {{{ {(n_1)}} ^i}}& {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}\end{array}\right]}$
<br>
${{{ A} ^I} _J} = {\left[\begin{array}{cc} 0& {{h}} {{{ {(n_1)}} _j}}\\ {{\gamma}} \cdot {{{ {(n_1)}} ^i}}& 0\end{array}\right]}$
<br>

<br>
Normal basis orthogonality:
<br>
${{{|n_1|}}^{2}} = {{{{{ {(n_1)}} _x}} {{{ {(n_1)}} ^x}}} + {{{{ {(n_1)}} _y}} {{{ {(n_1)}} ^y}}} + {{{{ {(n_1)}} _z}} {{{ {(n_1)}} ^z}}}}$
<br>
${{{|n_2|}}^{2}} = {{{{{ {(n_2)}} _x}} {{{ {(n_2)}} ^x}}} + {{{{ {(n_2)}} _y}} {{{ {(n_2)}} ^y}}} + {{{{ {(n_2)}} _z}} {{{ {(n_2)}} ^z}}}}$
<br>
${{{|n_3|}}^{2}} = {{{{{ {(n_3)}} _x}} {{{ {(n_3)}} ^x}}} + {{{{ {(n_3)}} _y}} {{{ {(n_3)}} ^y}}} + {{{{ {(n_3)}} _z}} {{{ {(n_3)}} ^z}}}}$
<br>

<br>
 $(n_m)_i (n_n)^i = (n_m)_i (n_n)_j g^{ij} = \delta_{mn} |n_m|^2$ 
<br>

<br>
 For $|n_i|$ is the metric-weighted norm. 
<br>

<br>
${{{{ {N^\flat_{3x3}}} ^T}} {{{N^\sharp_{3x3}}}}} = {{N^\parallel_{3x3}}}$
<br>

<br>
${{{{\left[\begin{array}{ccc} { {(n_1)}} _x& { {(n_1)}} _y& { {(n_1)}} _z\\ { {(n_2)}} _x& { {(n_2)}} _y& { {(n_2)}} _z\\ { {(n_3)}} _x& { {(n_3)}} _y& { {(n_3)}} _z\end{array}\right]}} {{\left[\begin{array}{ccc} { {(n_1)}} ^x& { {(n_2)}} ^x& { {(n_3)}} ^x\\ { {(n_1)}} ^y& { {(n_2)}} ^y& { {(n_3)}} ^y\\ { {(n_1)}} ^z& { {(n_2)}} ^z& { {(n_3)}} ^z\end{array}\right]}}} = {\left[\begin{array}{ccc} {{{{ {(n_1)}} ^x}} {{{ {(n_1)}} _x}}} + {{{{ {(n_1)}} ^y}} {{{ {(n_1)}} _y}}} + {{{{ {(n_1)}} ^z}} {{{ {(n_1)}} _z}}}& {{{{ {(n_1)}} _x}} {{{ {(n_2)}} ^x}}} + {{{{ {(n_1)}} _y}} {{{ {(n_2)}} ^y}}} + {{{{ {(n_1)}} _z}} {{{ {(n_2)}} ^z}}}& {{{{ {(n_1)}} _x}} {{{ {(n_3)}} ^x}}} + {{{{ {(n_1)}} _y}} {{{ {(n_3)}} ^y}}} + {{{{ {(n_1)}} _z}} {{{ {(n_3)}} ^z}}}\\ {{{{ {(n_1)}} ^x}} {{{ {(n_2)}} _x}}} + {{{{ {(n_1)}} ^y}} {{{ {(n_2)}} _y}}} + {{{{ {(n_1)}} ^z}} {{{ {(n_2)}} _z}}}& {{{{ {(n_2)}} ^x}} {{{ {(n_2)}} _x}}} + {{{{ {(n_2)}} ^y}} {{{ {(n_2)}} _y}}} + {{{{ {(n_2)}} ^z}} {{{ {(n_2)}} _z}}}& {{{{ {(n_2)}} _x}} {{{ {(n_3)}} ^x}}} + {{{{ {(n_2)}} _y}} {{{ {(n_3)}} ^y}}} + {{{{ {(n_2)}} _z}} {{{ {(n_3)}} ^z}}}\\ {{{{ {(n_1)}} ^x}} {{{ {(n_3)}} _x}}} + {{{{ {(n_1)}} ^y}} {{{ {(n_3)}} _y}}} + {{{{ {(n_1)}} ^z}} {{{ {(n_3)}} _z}}}& {{{{ {(n_2)}} ^x}} {{{ {(n_3)}} _x}}} + {{{{ {(n_2)}} ^y}} {{{ {(n_3)}} _y}}} + {{{{ {(n_2)}} ^z}} {{{ {(n_3)}} _z}}}& {{{{ {(n_3)}} ^x}} {{{ {(n_3)}} _x}}} + {{{{ {(n_3)}} ^y}} {{{ {(n_3)}} _y}}} + {{{{ {(n_3)}} ^z}} {{{ {(n_3)}} _z}}}\end{array}\right]}} = {\left[\begin{array}{ccc} {{|n_1|}}^{2}& 0& 0\\ 0& {{|n_2|}}^{2}& 0\\ 0& 0& {{|n_3|}}^{2}\end{array}\right]}$
<br>

<br>
In terms of identity:
<br>
${{{{ {N^\flat_{3x3}}} ^T}} {{{N^\sharp_{3x3}}}} \cdot {{{{N^\parallel_{3x3}}}^{-1}}}} = {I}$
<br>

<br>
${{{{ {N^\flat_{3x3}}} ^T}} {{{N^{\sharp/\parallel}_{3x3}}}}} = {I}$
<br>

<br>
${{{\left[\begin{array}{ccc} { {(n_1)}} _x& { {(n_1)}} _y& { {(n_1)}} _z\\ { {(n_2)}} _x& { {(n_2)}} _y& { {(n_2)}} _z\\ { {(n_3)}} _x& { {(n_3)}} _y& { {(n_3)}} _z\end{array}\right]}} {{\left[\begin{array}{ccc} \frac{{ {(n_1)}} ^x}{{{|n_1|}}^{2}}& \frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}}\\ \frac{{ {(n_1)}} ^y}{{{|n_1|}}^{2}}& \frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}}\\ \frac{{ {(n_1)}} ^z}{{{|n_1|}}^{2}}& \frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}}\end{array}\right]}}} = {\left[\begin{array}{ccc} 1& 0& 0\\ 0& 1& 0\\ 0& 0& 1\end{array}\right]}$
<br>

<br>
Acoustic matrix, expanded:
<br>
${{{ A} ^I} _J} = {\left[\begin{array}{cccc} 0& {{h}} {{{ {(n_1)}} _x}}& {{h}} {{{ {(n_1)}} _y}}& {{h}} {{{ {(n_1)}} _z}}\\ {{\gamma}} \cdot {{{ {(n_1)}} ^x}}& 0& 0& 0\\ {{\gamma}} \cdot {{{ {(n_1)}} ^y}}& 0& 0& 0\\ {{\gamma}} \cdot {{{ {(n_1)}} ^z}}& 0& 0& 0\end{array}\right]}$
<br>

<br>
Acoustic matrix in Cartesian basis in x-direction
<br>
${{{ A} ^I} _J} = {\left[\begin{array}{cccc} 0& h& 0& 0\\ \gamma& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& 0\end{array}\right]}$
<br>

<br>
Realigned, using the normal basis, which is inverses of one another, so that I can just apply it to the left and right eigenvector transforms.
<br>

<br>
${{{ A} ^I} _J} = {{{{N^{\sharp/\parallel}}}} \cdot {{{(A^x)}}} \cdot {{{N^\flat}}}}$
<br>

<br>
${{{{ A} ^I} _J} = {{{\left[\begin{array}{cccc} 1& 0& 0& 0\\ 0& \frac{{ {(n_1)}} ^x}{{{|n_1|}}^{2}}& \frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}}\\ 0& \frac{{ {(n_1)}} ^y}{{{|n_1|}}^{2}}& \frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}}\\ 0& \frac{{ {(n_1)}} ^z}{{{|n_1|}}^{2}}& \frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}}\end{array}\right]}} {{\left[\begin{array}{cccc} 0& h& 0& 0\\ {{\gamma}} \cdot {{{{|n_1|}}^{2}}}& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& 0\end{array}\right]}} {{\left[\begin{array}{cccc} 1& 0& 0& 0\\ 0& { {(n_1)}} _x& { {(n_1)}} _y& { {(n_1)}} _z\\ 0& { {(n_2)}} _x& { {(n_2)}} _y& { {(n_2)}} _z\\ 0& { {(n_3)}} _x& { {(n_3)}} _y& { {(n_3)}} _z\end{array}\right]}}}} = {\left[\begin{array}{cccc} 0& {{h}} {{{ {(n_1)}} _x}}& {{h}} {{{ {(n_1)}} _y}}& {{h}} {{{ {(n_1)}} _z}}\\ {{\gamma}} \cdot {{{ {(n_1)}} ^x}}& 0& 0& 0\\ {{\gamma}} \cdot {{{ {(n_1)}} ^y}}& 0& 0& 0\\ {{\gamma}} \cdot {{{ {(n_1)}} ^z}}& 0& 0& 0\end{array}\right]}$
<br>

<br>
Now we see how this similarity transform by the normal basis reproduces the original acoustic matrix with regards to any normal basis.
<br>
The Cartesian x-direction acoustic matrix is now replaced with one that is normal-length-weighted.
<br>
Lets continue to find the eigensystem of the normal-length-weighted Cartesian x-direction acoustic matrix.
<br>

<br>
Acoustic matrix eigen-decomposition for Cartesian x-direction:
<br>
${{{ {(A^x)}} ^I} _J} = {{{{{ {(R^x_A)}} ^I} _M}} {{{{ {(\Lambda_A)}} ^M} _N}} {{{{ {(L^x_A)}} ^N} _J}}}$
<br>

<br>
${{{ {(A^x)}} ^I} _J} = {{{\left[\begin{array}{cccc} 0& 0& \frac{h}{{{c}} {{{|n_1|}}}}& -{\frac{h}{{{c}} {{{|n_1|}}}}}\\ 0& 0& 1& 1\\ 1& 0& 0& 0\\ 0& 1& 0& 0\end{array}\right]}} {{\left[\begin{array}{cccc} 0& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& {{c}} {{{|n_1|}}}& 0\\ 0& 0& 0& -{{{c}} {{{|n_1|}}}}\end{array}\right]}} {{\left[\begin{array}{cccc} 0& 0& 1& 0\\ 0& 0& 0& 1\\ \frac{{{c}} {{{|n_1|}}}}{{{2}} {{h}}}& \frac{1}{2}& 0& 0\\ -{\frac{{{c}} {{{|n_1|}}}}{{{2}} {{h}}}}& \frac{1}{2}& 0& 0\end{array}\right]}}}$
<br>
scale by:	$\left[\begin{array}{cccc} {{c}} {{{|n_1|}}}& 0& 0& 0\\ 0& 1& 0& 0\\ 0& 0& 1& 0\\ 0& 0& 0& {{c}} {{{|n_1|}}}\end{array}\right]$	, permute by:	$\left[\begin{array}{cccc} 0& 1& 0& 0\\ 0& 0& 1& 0\\ 0& 0& 0& 1\\ 1& 0& 0& 0\end{array}\right]$
<br>
${{{ {(A^x)}} ^I} _J} = {{{\left[\begin{array}{cccc} -{h}& 0& 0& h\\ {{c}} {{{|n_1|}}}& 0& 0& {{c}} {{{|n_1|}}}\\ 0& 1& 0& 0\\ 0& 0& 1& 0\end{array}\right]}} {{\left[\begin{array}{cccc} -{{{c}} {{{|n_1|}}}}& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& {{c}} {{{|n_1|}}}\end{array}\right]}} {{\left[\begin{array}{cccc} -{\frac{1}{{{2}} {{h}}}}& \frac{1}{{{2}} {{c}} {{{|n_1|}}}}& 0& 0\\ 0& 0& 1& 0\\ 0& 0& 0& 1\\ \frac{1}{{{2}} {{h}}}& \frac{1}{{{2}} {{c}} {{{|n_1|}}}}& 0& 0\end{array}\right]}}}$
<br>

<br>
${{(R^x_A)}} = {\left[\begin{array}{cccc} -{h}& 0& 0& h\\ {{c}} {{{|n_1|}}}& 0& 0& {{c}} {{{|n_1|}}}\\ 0& 1& 0& 0\\ 0& 0& 1& 0\end{array}\right]}$
<br>
${{(L^x_A)}} = {\left[\begin{array}{cccc} -{\frac{1}{{{2}} {{h}}}}& \frac{1}{{{2}} {{c}} {{{|n_1|}}}}& 0& 0\\ 0& 0& 1& 0\\ 0& 0& 0& 1\\ \frac{1}{{{2}} {{h}}}& \frac{1}{{{2}} {{c}} {{{|n_1|}}}}& 0& 0\end{array}\right]}$
<br>
${{(\Lambda_A)}} = {\left[\begin{array}{cccc} -{{{c}} {{{|n_1|}}}}& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& {{c}} {{{|n_1|}}}\end{array}\right]}$
<br>

<br>
Acoustic matrix, reconstructed from eigen-decomposition:
<br>
${{{ {(A^x)}} ^I} _J} = {\left[\begin{array}{cccc} 0& h& 0& 0\\ {{\gamma}} \cdot {{{{|n_1|}}^{2}}}& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& 0\end{array}\right]}$
<br>

<br>
Orthogonality of left and right eigenvectors:
<br>

<br>
${{{{(R^x_A)}}} \cdot {{{(L^x_A)}}}} = {\left[\begin{array}{cccc} 1& 0& 0& 0\\ 0& 1& 0& 0\\ 0& 0& 1& 0\\ 0& 0& 0& 1\end{array}\right]}$
<br>

<br>
Now transform the left and right eigenvectors by the normal basis
<br>

<br>
${{{{N^{\sharp/\parallel}}}} \cdot {{{(R^x_A)}}} \cdot {{{\Lambda_A}}} \cdot {{{(L^x_A)}}} \cdot {{{N^\flat}}}} = {A}$
<br>

<br>
${{\left[\begin{array}{cccc} 1& 0& 0& 0\\ 0& \frac{{ {(n_1)}} ^x}{{{|n_1|}}^{2}}& \frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}}\\ 0& \frac{{ {(n_1)}} ^y}{{{|n_1|}}^{2}}& \frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}}\\ 0& \frac{{ {(n_1)}} ^z}{{{|n_1|}}^{2}}& \frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}}\end{array}\right]}} {{\left[\begin{array}{cccc} -{h}& 0& 0& h\\ {{c}} {{{|n_1|}}}& 0& 0& {{c}} {{{|n_1|}}}\\ 0& 1& 0& 0\\ 0& 0& 1& 0\end{array}\right]}} {{\left[\begin{array}{cccc} -{{{c}} {{{|n_1|}}}}& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& {{c}} {{{|n_1|}}}\end{array}\right]}} {{\left[\begin{array}{cccc} -{\frac{1}{{{2}} {{h}}}}& \frac{1}{{{2}} {{c}} {{{|n_1|}}}}& 0& 0\\ 0& 0& 1& 0\\ 0& 0& 0& 1\\ \frac{1}{{{2}} {{h}}}& \frac{1}{{{2}} {{c}} {{{|n_1|}}}}& 0& 0\end{array}\right]}} {{\left[\begin{array}{cccc} 1& 0& 0& 0\\ 0& { {(n_1)}} _x& { {(n_1)}} _y& { {(n_1)}} _z\\ 0& { {(n_2)}} _x& { {(n_2)}} _y& { {(n_2)}} _z\\ 0& { {(n_3)}} _x& { {(n_3)}} _y& { {(n_3)}} _z\end{array}\right]}}$
<br>
=	${{\left[\begin{array}{cccc} -{h}& 0& 0& h\\ {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^x}}}& \frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}}& {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^x}}}\\ {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^y}}}& \frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}}& {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^y}}}\\ {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^z}}}& \frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}}& {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^z}}}\end{array}\right]}} {{\left[\begin{array}{cccc} -{{{c}} {{{|n_1|}}}}& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& 0\\ 0& 0& 0& {{c}} {{{|n_1|}}}\end{array}\right]}} {{\left[\begin{array}{cccc} -{\frac{1}{{{2}} {{h}}}}& \frac{{ {(n_1)}} _x}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _y}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _z}{{{2}} {{c}} {{{|n_1|}}}}\\ 0& { {(n_2)}} _x& { {(n_2)}} _y& { {(n_2)}} _z\\ 0& { {(n_3)}} _x& { {(n_3)}} _y& { {(n_3)}} _z\\ \frac{1}{{{2}} {{h}}}& \frac{{ {(n_1)}} _x}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _y}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _z}{{{2}} {{c}} {{{|n_1|}}}}\end{array}\right]}}$
<br>
=	$\left[\begin{array}{cccc} 0& {{h}} {{{ {(n_1)}} _x}}& {{h}} {{{ {(n_1)}} _y}}& {{h}} {{{ {(n_1)}} _z}}\\ {{\gamma}} \cdot {{{ {(n_1)}} ^x}}& 0& 0& 0\\ {{\gamma}} \cdot {{{ {(n_1)}} ^y}}& 0& 0& 0\\ {{\gamma}} \cdot {{{ {(n_1)}} ^z}}& 0& 0& 0\end{array}\right]$
<br>

<br>
Let	${{R_A}} = {{{{N^{\sharp/\parallel}}}} \cdot {{{(R^x_A)}}}}$	,	${{L_A}} = {{{{(L^x_A)}}} \cdot {{{N^\flat}}}}$
<br>

<br>
${{R_A}} = {\left[\begin{array}{cccc} -{h}& 0& 0& h\\ {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^x}}}& \frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}}& {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^x}}}\\ {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^y}}}& \frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}}& {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^y}}}\\ {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^z}}}& \frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}}& {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^z}}}\end{array}\right]}$
<br>
${{L_A}} = {\left[\begin{array}{cccc} -{\frac{1}{{{2}} {{h}}}}& \frac{{ {(n_1)}} _x}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _y}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _z}{{{2}} {{c}} {{{|n_1|}}}}\\ 0& { {(n_2)}} _x& { {(n_2)}} _y& { {(n_2)}} _z\\ 0& { {(n_3)}} _x& { {(n_3)}} _y& { {(n_3)}} _z\\ \frac{1}{{{2}} {{h}}}& \frac{{ {(n_1)}} _x}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _y}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _z}{{{2}} {{c}} {{{|n_1|}}}}\end{array}\right]}$
<br>

<br>
$A$'s eigensystem is $R_A \Lambda_A L_A$.<br>
$A + v I$'s eigensystem is $R_A \Lambda_A L_A + v I 
	= R_A \Lambda_A L_A + v R_A L_A 
	= R_A (\Lambda_A + v I) L_A$
.<br>
$\frac{\partial W}{\partial U} \cdot \frac{\partial F}{\partial W} = A + v I$<br>
$\frac{\partial F}{\partial U} = \frac{\partial U}{\partial W} \cdot \frac{\partial W}{\partial U} \cdot \frac{\partial F}{\partial W} \cdot \frac{\partial W}{\partial U} 
	= \frac{\partial U}{\partial W} \cdot (A + v I) \cdot \frac{\partial W}{\partial U}
	= \frac{\partial U}{\partial W} \cdot R_A (\Lambda_A + v I) L_A \cdot \frac{\partial W}{\partial U}$.<br>
Let $R_F = \frac{\partial U}{\partial W} \cdot R_A,
	\Lambda_F = \Lambda_A + v I,
	L_F = L_A \cdot \frac{\partial W}{\partial U}$.<br>
$\frac{\partial F}{\partial U} = R_F \Lambda_F L_F$.<br>


<br>
Flux Jacobian with respect to conserved variables:
<br>
${\frac{\partial { F} ^I}{\partial { U} ^J}} = {{{\frac{\partial { U} ^I}{\partial { W} ^K}}} {{\frac{\partial { W} ^K}{\partial { U} ^L}}} {{\frac{\partial { F} ^L}{\partial { W} ^M}}} {{\frac{\partial { W} ^M}{\partial { U} ^J}}}}$
<br>

<br>
${{R_F}} = {{{\left[\begin{array}{cccc} 1& 0& 0& 0\\ { v} ^x& h& 0& 0\\ { v} ^y& 0& h& 0\\ { v} ^z& 0& 0& h\end{array}\right]}} {{\left[\begin{array}{cccc} -{h}& 0& 0& h\\ {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^x}}}& \frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}}& {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^x}}}\\ {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^y}}}& \frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}}& {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^y}}}\\ {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^z}}}& \frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}}& \frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}}& {\frac{1}{{|n_1|}}} {{{c}} {{{ {(n_1)}} ^z}}}\end{array}\right]}}}$
<br>
${{R_F}} = {\left[\begin{array}{cccc} {{-1}} {{h}}& 0& 0& h\\ {{{c}} {{h}} {{{ {(n_1)}} ^x}} {{\frac{1}{{|n_1|}}}}} + {{{-1}} {{h}} {{{ v} ^x}}}& {{h}} {{{ {(n_2)}} ^x}} {{\frac{1}{{{|n_2|}}^{2}}}}& {{h}} {{{ {(n_3)}} ^x}} {{\frac{1}{{{|n_3|}}^{2}}}}& {{{c}} {{h}} {{{ {(n_1)}} ^x}} {{\frac{1}{{|n_1|}}}}} + {{{h}} {{{ v} ^x}}}\\ {{{c}} {{h}} {{{ {(n_1)}} ^y}} {{\frac{1}{{|n_1|}}}}} + {{{-1}} {{h}} {{{ v} ^y}}}& {{h}} {{{ {(n_2)}} ^y}} {{\frac{1}{{{|n_2|}}^{2}}}}& {{h}} {{{ {(n_3)}} ^y}} {{\frac{1}{{{|n_3|}}^{2}}}}& {{{c}} {{h}} {{{ {(n_1)}} ^y}} {{\frac{1}{{|n_1|}}}}} + {{{h}} {{{ v} ^y}}}\\ {{{c}} {{h}} {{{ {(n_1)}} ^z}} {{\frac{1}{{|n_1|}}}}} + {{{-1}} {{h}} {{{ v} ^z}}}& {{h}} {{{ {(n_2)}} ^z}} {{\frac{1}{{{|n_2|}}^{2}}}}& {{h}} {{{ {(n_3)}} ^z}} {{\frac{1}{{{|n_3|}}^{2}}}}& {{{c}} {{h}} {{{ {(n_1)}} ^z}} {{\frac{1}{{|n_1|}}}}} + {{{h}} {{{ v} ^z}}}\end{array}\right]}$
<br>
${{L_F}} = {{{\left[\begin{array}{cccc} -{\frac{1}{{{2}} {{h}}}}& \frac{{ {(n_1)}} _x}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _y}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _z}{{{2}} {{c}} {{{|n_1|}}}}\\ 0& { {(n_2)}} _x& { {(n_2)}} _y& { {(n_2)}} _z\\ 0& { {(n_3)}} _x& { {(n_3)}} _y& { {(n_3)}} _z\\ \frac{1}{{{2}} {{h}}}& \frac{{ {(n_1)}} _x}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _y}{{{2}} {{c}} {{{|n_1|}}}}& \frac{{ {(n_1)}} _z}{{{2}} {{c}} {{{|n_1|}}}}\end{array}\right]}} {{\left[\begin{array}{cccc} 1& 0& 0& 0\\ -{{\frac{1}{h}} {{ v} ^x}}& \frac{1}{h}& 0& 0\\ -{{\frac{1}{h}} {{ v} ^y}}& 0& \frac{1}{h}& 0\\ -{{\frac{1}{h}} {{ v} ^z}}& 0& 0& \frac{1}{h}\end{array}\right]}}}$
<br>
${{L_F}} = {\left[\begin{array}{cccc} {{{-1}} \cdot {{\frac{1}{2}}} {{\frac{1}{h}}}} + {{{-1}} \cdot {{\frac{1}{2}}} {{{ {(n_1)}} _k}} {{{ v} ^k}} {{\frac{1}{c}}} {{\frac{1}{h}}} {{\frac{1}{{|n_1|}}}}}& {{\frac{1}{2}}} {{{ {(n_1)}} _x}} {{\frac{1}{c}}} {{\frac{1}{h}}} {{\frac{1}{{|n_1|}}}}& {{\frac{1}{2}}} {{{ {(n_1)}} _y}} {{\frac{1}{c}}} {{\frac{1}{h}}} {{\frac{1}{{|n_1|}}}}& {{\frac{1}{2}}} {{{ {(n_1)}} _z}} {{\frac{1}{c}}} {{\frac{1}{h}}} {{\frac{1}{{|n_1|}}}}\\ {{{-1}} {{{ {(n_2)}} _z}} {{{ v} ^z}} {{\frac{1}{h}}}} + {{{-1}} {{{ {(n_2)}} _y}} {{{ v} ^y}} {{\frac{1}{h}}}} + {{{-1}} {{{ {(n_2)}} _x}} {{{ v} ^x}} {{\frac{1}{h}}}}& {{{ {(n_2)}} _x}} {{\frac{1}{h}}}& {{{ {(n_2)}} _y}} {{\frac{1}{h}}}& {{{ {(n_2)}} _z}} {{\frac{1}{h}}}\\ {{{-1}} {{{ {(n_3)}} _z}} {{{ v} ^z}} {{\frac{1}{h}}}} + {{{-1}} {{{ {(n_3)}} _y}} {{{ v} ^y}} {{\frac{1}{h}}}} + {{{-1}} {{{ {(n_3)}} _x}} {{{ v} ^x}} {{\frac{1}{h}}}}& {{{ {(n_3)}} _x}} {{\frac{1}{h}}}& {{{ {(n_3)}} _y}} {{\frac{1}{h}}}& {{{ {(n_3)}} _z}} {{\frac{1}{h}}}\\ {\frac{1}{{{2}} {{h}}}} + {{{-1}} \cdot {{\frac{1}{2}}} {{{ {(n_1)}} _k}} {{{ v} ^k}} {{\frac{1}{c}}} {{\frac{1}{h}}} {{\frac{1}{{|n_1|}}}}}& {{\frac{1}{2}}} {{{ {(n_1)}} _x}} {{\frac{1}{c}}} {{\frac{1}{h}}} {{\frac{1}{{|n_1|}}}}& {{\frac{1}{2}}} {{{ {(n_1)}} _y}} {{\frac{1}{c}}} {{\frac{1}{h}}} {{\frac{1}{{|n_1|}}}}& {{\frac{1}{2}}} {{{ {(n_1)}} _z}} {{\frac{1}{c}}} {{\frac{1}{h}}} {{\frac{1}{{|n_1|}}}}\end{array}\right]}$
<br>

<br>
eigensystem transforms applied to vectors:
<br>
${{{{L_F}}} \cdot {{X}}} = {\left[\begin{array}{c} \frac{{{{{X^1}}} \cdot {{{ {(n_1)}} _x}}} + {{{{X^2}}} \cdot {{{ {(n_1)}} _y}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} _z}}}{-{{{{X^0}}} \cdot {{c}} {{{|n_1|}}}}}{-{{{{X^0}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}}}}{{{2}} {{c}} {{h}} {{{|n_1|}}}}\\ {\frac{1}{h}}{\left({{{{{X^1}}} \cdot {{{ {(n_2)}} _x}}} + {{{{X^2}}} \cdot {{{ {(n_2)}} _y}}} + {{{{X^3}}} \cdot {{{ {(n_2)}} _z}}}{-{{{{X^0}}} \cdot {{{ {(n_2)}} _x}} {{{ v} ^x}}}}{-{{{{X^0}}} \cdot {{{ {(n_2)}} _y}} {{{ v} ^y}}}}{-{{{{X^0}}} \cdot {{{ {(n_2)}} _z}} {{{ v} ^z}}}}}\right)}\\ {\frac{1}{h}}{\left({{{{{X^1}}} \cdot {{{ {(n_3)}} _x}}} + {{{{X^2}}} \cdot {{{ {(n_3)}} _y}}} + {{{{X^3}}} \cdot {{{ {(n_3)}} _z}}}{-{{{{X^0}}} \cdot {{{ {(n_3)}} _x}} {{{ v} ^x}}}}{-{{{{X^0}}} \cdot {{{ {(n_3)}} _y}} {{{ v} ^y}}}}{-{{{{X^0}}} \cdot {{{ {(n_3)}} _z}} {{{ v} ^z}}}}}\right)}\\ \frac{{{{{X^1}}} \cdot {{{ {(n_1)}} _x}}} + {{{{X^2}}} \cdot {{{ {(n_1)}} _y}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} _z}}} + {{{{X^0}}} \cdot {{c}} {{{|n_1|}}}}{-{{{{X^0}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}}}}{{{2}} {{c}} {{h}} {{{|n_1|}}}}\end{array}\right]}$
<br>

<br>
${{{{R_F}}} \cdot {{X}}} = {\left[\begin{array}{c} {{h}} {{\left({{-{{X^0}}} + {{X^3}}}\right)}}\\ \frac{{{h}} {{\left({{{{{X^0}}} \cdot {{c}} {{{ {(n_1)}} ^x}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}{-{{{{X^0}}} \cdot {{{|n_1|}}} \cdot {{{ v} ^x}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}} + {{{{X^1}}} \cdot {{{|n_1|}}} \cdot {{{ {(n_2)}} ^x}} {{{{|n_3|}}^{2}}}} + {{{{X^2}}} \cdot {{{|n_1|}}} \cdot {{{ {(n_3)}} ^x}} {{{{|n_2|}}^{2}}}} + {{{{X^3}}} \cdot {{c}} {{{ {(n_1)}} ^x}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}} + {{{{X^3}}} \cdot {{{|n_1|}}} \cdot {{{ v} ^x}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}}\right)}}}{{{{|n_1|}}} \cdot {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}\\ \frac{{{h}} {{\left({{{{{X^0}}} \cdot {{c}} {{{ {(n_1)}} ^y}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}{-{{{{X^0}}} \cdot {{{|n_1|}}} \cdot {{{ v} ^y}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}} + {{{{X^1}}} \cdot {{{|n_1|}}} \cdot {{{ {(n_2)}} ^y}} {{{{|n_3|}}^{2}}}} + {{{{X^2}}} \cdot {{{|n_1|}}} \cdot {{{ {(n_3)}} ^y}} {{{{|n_2|}}^{2}}}} + {{{{X^3}}} \cdot {{c}} {{{ {(n_1)}} ^y}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}} + {{{{X^3}}} \cdot {{{|n_1|}}} \cdot {{{ v} ^y}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}}\right)}}}{{{{|n_1|}}} \cdot {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}\\ \frac{{{h}} {{\left({{{{{X^0}}} \cdot {{c}} {{{ {(n_1)}} ^z}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}{-{{{{X^0}}} \cdot {{{|n_1|}}} \cdot {{{ v} ^z}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}} + {{{{X^1}}} \cdot {{{|n_1|}}} \cdot {{{ {(n_2)}} ^z}} {{{{|n_3|}}^{2}}}} + {{{{X^2}}} \cdot {{{|n_1|}}} \cdot {{{ {(n_3)}} ^z}} {{{{|n_2|}}^{2}}}} + {{{{X^3}}} \cdot {{c}} {{{ {(n_1)}} ^z}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}} + {{{{X^3}}} \cdot {{{|n_1|}}} \cdot {{{ v} ^z}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}}\right)}}}{{{{|n_1|}}} \cdot {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}\end{array}\right]}$
<br>

<br>
${{{2}} {{c}} {{h}} {{{|n_1|}}} \cdot {{{L_F}}} \cdot {{X}}} = {\left[\begin{array}{c} {{{{X^1}}} \cdot {{{ {(n_1)}} _x}}} + {{{{X^2}}} \cdot {{{ {(n_1)}} _y}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} _z}}}{-{{{{X^0}}} \cdot {{c}} {{{|n_1|}}}}}{-{{{{X^0}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}}}\\ {{2}} {{c}} {{{|n_1|}}} \cdot {{\left({{{{{X^1}}} \cdot {{{ {(n_2)}} _x}}} + {{{{X^2}}} \cdot {{{ {(n_2)}} _y}}} + {{{{X^3}}} \cdot {{{ {(n_2)}} _z}}}{-{{{{X^0}}} \cdot {{{ {(n_2)}} _x}} {{{ v} ^x}}}}{-{{{{X^0}}} \cdot {{{ {(n_2)}} _y}} {{{ v} ^y}}}}{-{{{{X^0}}} \cdot {{{ {(n_2)}} _z}} {{{ v} ^z}}}}}\right)}}\\ {{2}} {{c}} {{{|n_1|}}} \cdot {{\left({{{{{X^1}}} \cdot {{{ {(n_3)}} _x}}} + {{{{X^2}}} \cdot {{{ {(n_3)}} _y}}} + {{{{X^3}}} \cdot {{{ {(n_3)}} _z}}}{-{{{{X^0}}} \cdot {{{ {(n_3)}} _x}} {{{ v} ^x}}}}{-{{{{X^0}}} \cdot {{{ {(n_3)}} _y}} {{{ v} ^y}}}}{-{{{{X^0}}} \cdot {{{ {(n_3)}} _z}} {{{ v} ^z}}}}}\right)}}\\ {{{{X^1}}} \cdot {{{ {(n_1)}} _x}}} + {{{{X^2}}} \cdot {{{ {(n_1)}} _y}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} _z}}} + {{{{X^0}}} \cdot {{c}} {{{|n_1|}}}}{-{{{{X^0}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}}}\end{array}\right]}$
<br>

<br>
${{{c}} {{{R_F}}} \cdot {{X}}} = {\left[\begin{array}{c} {{c}} {{h}} {{\left({{-{{X^0}}} + {{X^3}}}\right)}}\\ \frac{{{h}} {{\left({{{{{X^0}}} \cdot {{{ {(n_1)}} ^x}} {{{c}^{2}}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} ^x}} {{{c}^{2}}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}{-{{{{X^0}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ v} ^x}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}} + {{{{X^1}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ {(n_2)}} ^x}} {{{{|n_3|}}^{2}}}} + {{{{X^2}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ {(n_3)}} ^x}} {{{{|n_2|}}^{2}}}} + {{{{X^3}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ v} ^x}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}}\right)}}}{{{{|n_1|}}} \cdot {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}\\ \frac{{{h}} {{\left({{{{{X^0}}} \cdot {{{ {(n_1)}} ^y}} {{{c}^{2}}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} ^y}} {{{c}^{2}}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}{-{{{{X^0}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ v} ^y}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}} + {{{{X^1}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ {(n_2)}} ^y}} {{{{|n_3|}}^{2}}}} + {{{{X^2}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ {(n_3)}} ^y}} {{{{|n_2|}}^{2}}}} + {{{{X^3}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ v} ^y}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}}\right)}}}{{{{|n_1|}}} \cdot {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}\\ \frac{{{h}} {{\left({{{{{X^0}}} \cdot {{{ {(n_1)}} ^z}} {{{c}^{2}}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} ^z}} {{{c}^{2}}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}{-{{{{X^0}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ v} ^z}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}} + {{{{X^1}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ {(n_2)}} ^z}} {{{{|n_3|}}^{2}}}} + {{{{X^2}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ {(n_3)}} ^z}} {{{{|n_2|}}^{2}}}} + {{{{X^3}}} \cdot {{c}} {{{|n_1|}}} \cdot {{{ v} ^z}} {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}}\right)}}}{{{{|n_1|}}} \cdot {{{{|n_2|}}^{2}}} {{{{|n_3|}}^{2}}}}\end{array}\right]}$
<br>

<br>
${{{\frac{\partial { F} ^I}{\partial { U} ^J}}} {{X}}} = {\left[\begin{array}{c} {{{{X^1}}} \cdot {{{ {(n_1)}} _x}}} + {{{{X^2}}} \cdot {{{ {(n_1)}} _y}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} _z}}}\\ {{{{X^1}}} \cdot {{{ {(n_1)}} _x}} {{{ v} ^x}}} + {{{{X^1}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}} + {{{{X^2}}} \cdot {{{ {(n_1)}} _y}} {{{ v} ^x}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} _z}} {{{ v} ^x}}} + {{{{X^0}}} \cdot {{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^x}}}{-{{{{X^0}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{ v} ^x}}}}\\ {{{{X^1}}} \cdot {{{ {(n_1)}} _x}} {{{ v} ^y}}} + {{{{X^2}}} \cdot {{{ {(n_1)}} _y}} {{{ v} ^y}}} + {{{{X^2}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} _z}} {{{ v} ^y}}} + {{{{X^0}}} \cdot {{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^y}}}{-{{{{X^0}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{ v} ^y}}}}\\ {{{{X^1}}} \cdot {{{ {(n_1)}} _x}} {{{ v} ^z}}} + {{{{X^2}}} \cdot {{{ {(n_1)}} _y}} {{{ v} ^z}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}} + {{{{X^3}}} \cdot {{{ {(n_1)}} _z}} {{{ v} ^z}}} + {{{{X^0}}} \cdot {{\gamma}} \cdot {{h}} {{{ {(n_1)}} ^z}}}{-{{{{X^0}}} \cdot {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{ v} ^z}}}}\end{array}\right]}$
<br>

<br>
${{2}} {{c}} {{h}} {{{|n_1|}}} \cdot {{{L_F}}} \cdot {{X}}$	as code:
<br>
<pre>
real const invDenom = 1. / (2. * nLen * (eig)->h * (eig)->C);
real const tmp1 = (eig)->C * (X)->ptr[0];
real const tmp2 = nLen * tmp1;
real const tmp3 = v_n * (X)->ptr[0];
real const tmp4 = -tmp3;
real const tmp5 = nL.z * (X)->ptr[3];
real const tmp6 = nL.y * (X)->ptr[2];
real const tmp7 = nL.x * (X)->ptr[1];
real const tmp8 = (eig)->v.x * (X)->ptr[0];
real const tmp9 = (eig)->v.y * (X)->ptr[0];
real const tmp10 = (eig)->v.z * (X)->ptr[0];
real const tmp11 = nLen * (eig)->C;
real const tmp12 = invDenom * tmp11;
(result)->ptr[0] = invDenom * (-tmp2 + tmp4 + tmp5 + tmp6 + tmp7);
(result)->ptr[1] = 2. * (n2L.x * (X)->ptr[1] + n2L.y * (X)->ptr[2] + n2L.z * (X)->ptr[3] + -n2L.x * tmp8 + -n2L.z * tmp10 + -n2L.y * tmp9) * tmp12;
(result)->ptr[2] = 2. * (n3L.x * (X)->ptr[1] + n3L.y * (X)->ptr[2] + n3L.z * (X)->ptr[3] + -n3L.x * tmp8 + -n3L.z * tmp10 + -n3L.y * tmp9) * tmp12;
(result)->ptr[3] = invDenom * (tmp2 + tmp4 + tmp5 + tmp6 + tmp7);
</pre>
<br>

<br>
${{{R_F}}} \cdot {{X}}$	as code:
<br>
<pre>
real const invDenom = 1. / (eig)->C;
real const tmp1 = n3Len * n3Len;
real const tmp2 = n2Len * n2Len;
real const tmp3 = (X)->ptr[0] * tmp1;
real const tmp4 = (eig)->C * (eig)->C;
real const tmp5 = tmp2 * tmp3;
real const tmp6 = tmp4 * tmp5;
real const tmp7 = (X)->ptr[3] * tmp1;
real const tmp8 = tmp2 * tmp7;
real const tmp9 = tmp4 * tmp8;
real const tmp10 = (eig)->C * (X)->ptr[0];
real const tmp11 = nLen * tmp10;
real const tmp12 = tmp1 * tmp11;
real const tmp13 = tmp2 * tmp12;
real const tmp14 = (eig)->C * (X)->ptr[1];
real const tmp15 = nLen * tmp14;
real const tmp16 = tmp1 * tmp15;
real const tmp17 = (eig)->C * (X)->ptr[2];
real const tmp18 = nLen * tmp17;
real const tmp19 = tmp2 * tmp18;
real const tmp20 = (eig)->C * (X)->ptr[3];
real const tmp21 = nLen * tmp20;
real const tmp22 = tmp1 * tmp21;
real const tmp23 = tmp2 * tmp22;
real const tmp24 = nLen * tmp1;
real const tmp25 = tmp2 * tmp24;
(result)->ptr[0] = invDenom * ((X)->ptr[3] + -(X)->ptr[0]) * (eig)->h * (eig)->C;
(result)->ptr[1] = invDenom * ((eig)->h * (nU.x * tmp6 + nU.x * tmp9 + -(eig)->v.x * tmp13 + n2U.x * tmp16 + (eig)->v.x * tmp23 + n3U.x * tmp19)) / tmp25;
(result)->ptr[2] = invDenom * ((eig)->h * (nU.y * tmp6 + nU.y * tmp9 + -(eig)->v.y * tmp13 + n2U.y * tmp16 + (eig)->v.y * tmp23 + n3U.y * tmp19)) / tmp25;
(result)->ptr[3] = invDenom * ((eig)->h * (nU.z * tmp6 + nU.z * tmp9 + -(eig)->v.z * tmp13 + n2U.z * tmp16 + (eig)->v.z * tmp23 + n3U.z * tmp19)) / tmp25;
</pre>
<br>

<br>
${{\frac{\partial { F} ^I}{\partial { U} ^J}}} {{X}}$	as code:
<br>
<pre>
real const tmp1 = (eig)->h * (X)->ptr[0];
real const tmp2 = solver->gravity * tmp1;
real const tmp3 = v_n * (X)->ptr[0];
(result)->ptr[0] = nL.x * (X)->ptr[1] + nL.z * (X)->ptr[3] + nL.y * (X)->ptr[2];
(result)->ptr[1] = nL.x * (eig)->v.x * (X)->ptr[1] + v_n * (X)->ptr[1] + nL.y * (eig)->v.x * (X)->ptr[2] + nL.z * (eig)->v.x * (X)->ptr[3] + -(eig)->v.x * tmp3 + nU.x * tmp2;
(result)->ptr[2] = nL.x * (eig)->v.y * (X)->ptr[1] + nL.y * (eig)->v.y * (X)->ptr[2] + v_n * (X)->ptr[2] + nL.z * (eig)->v.y * (X)->ptr[3] + -(eig)->v.y * tmp3 + nU.y * tmp2;
(result)->ptr[3] = nL.x * (eig)->v.z * (X)->ptr[1] + nL.y * (eig)->v.z * (X)->ptr[2] + v_n * (X)->ptr[3] + nL.z * (eig)->v.z * (X)->ptr[3] + -(eig)->v.z * tmp3 + nU.z * tmp2;
</pre>
<br>

<br>
